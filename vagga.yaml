containers:

  sphinx:
    builder: nix
    parameters:
      config: default.nix
      attribute: sphinx

  ubuntu:
    builder: ubuntu
    uids: [0-1000, 65534]
    gids: [0-1000, 65534]
    parameters:
      repos: universe
      PPAs: hansjorg/rust
      additional_keys: 37FD5E80BD6B6386  # for rust
      packages: make checkinstall rust-0.11
    provision:
      export PATH=/bin;
      rmdir /var/tmp;
      ln -sfT /tmp /var/tmp;

commands:
  build-docs:
    description: Build vagga documentation using sphinx
    container: sphinx
    work-dir: docs
    command: make

  build-ubuntu-package:
    container: ubuntu
    write-mode: transient-hard-link-copy
    command:
    - checkinstall
    - --default
    - --maintainer=paul@colomiets.name
    - --pkglicense=MIT
    - --pkgname=vagga
    - --nodoc
    - make
    - -B
    - all
    - install
