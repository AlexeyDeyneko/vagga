#!/bin/sh -ex

mount --rbind $root $mount_dir
mount -o remount,ro,bind $root $mount_dir
mount --rbind /sys $mount_dir/sys
mount -o remount,ro,bind /sys $mount_dir/sys
mount --rbind /dev $mount_dir/dev
mount -o remount,ro,bind /dev $mount_dir/dev
mount --rbind . $mount_dir/work
mount -t proc,ro proc $mount_dir/proc
mount -t tmpfs tmpfs $mount_dir/tmp

export PATH=/bin:/usr/bin:/usr/local/bin:$PATH
exec chroot $mount_dir /bin/sh -xc "cd $workdir; exec $@"
